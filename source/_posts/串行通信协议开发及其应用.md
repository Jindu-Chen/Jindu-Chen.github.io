---
title: 私有通信协议栈的开发设计与应用
date: 2024-03-13
tags:
categories:
- [嵌入式]
description: 通信协议是设备间协同工作的关键，当然此处所说的通信协议并不是指硬件层的 UART、IIC、SPI 等通信接口，也不是指 BLE、WI-FI、USB 此类数据传输协议，其是特指在已经实现设备间数据透明传输通路的基础上，再封装的一层私有协议，用于规范设备间业务数据/功能/命令等的交互，从而实现稳定可靠的多设备多模块间协同工作。
---



## 前言


## 协议格式

### 包的构成要素

起始位、结束位

协议版本、包序号、包类型、控制位、保留位、数据长度、数据、检验位

协议需要定义 发送包格式 和 回复包格式

发送包可以有多种包类型，针对发送包的回复包也要相应的回复响应包类型。 回复包需要包含所要回复的发送包包序号

发送方向可以是 控制器 to 模块，也可以是 模块 to 控制器，等等不固定

多设备设计时需要设计地址

#### 发送包格式


#### 回复包格式



### 包类型

握手初始化 -- 握手、回复

命令、数据请求、通知

### 协议工作流程


### 小结

## 通用中间件软件设计

### 软件设计要素

回调函数（包括私有句柄、包类型、命令码、数据缓存指针、数据长度）

超时设计

分包设计

间隔设计

最大最小包限制设计

### 解包设计

提供多个接口包括：逐个字节解包，多个字节解包


### 组包设计



### 容错设计


## 串行通信业务软件设计



### 初始化软件设计



### 业务处理软件设计


## 疑惑解答



## 参考站点


- [通信教程 | 自定义串口通信协议](https://blog.csdn.net/ybhuangfugui/article/details/123143683)


