---
title: 嵌入式开发之音频杂项知识记录
date: 2023-11-01
tags:
categories:
description: 本人并不专于音频开发，但日常工作中难免也会经常接触到音频，因此写下本文记录嵌入式与其相关的基础知识，包括但不限于音频采集、播放、编解码、频谱分析、编码开发应用等方面，便于理清其基本概念及开发思路。
---


未完待续...

---


功放与扬声器的关系，为什么直接断电时 扬声器会嘭的一声： 功放电容直接关闭时瞬间放电导致SPK发声

关机时需要先把功放给关掉，  另外ES8388也要等电容的电放完 才能再次上电通讯，否则iic会通讯失败

将mp3文件通过esp32自带的转换工具转成bin文件，而后烧录到esp32的指定地址。（mp3文件命名转换与esp32代码中mp3命名一一对应） 

esp32调用库接口解码播放相应的mp3歌曲，通过IIS将数字音频信号输出到ES8388音频解码器，转换成相应的交流信号，再经过功率放大器放大 音频的电信号，最后输出到扬声器将 电信号转换成声音

ESP32 IIC IIS->音频解码->功率放大器->扬声器

语音识别和回音消除，  通过ES7243E模数转换器，将外界的声音转换成数字信号给ESP32识别，采集MIC的声音减去SPK的声音就是真实的外界声音



## 前言

正弦波是最简单的周期性信号之一，其数学表达式非常简单，如下：

**y(t)=Asin(2πft+ϕ)**

其中：
y(t) 是正弦波在时间 t 处的值。
A 是振幅，表示波形的最大振动幅度。
f 是频率，表示波形的周期性变化次数。
ϕ 是相位，表示波形在时间轴上的偏移。

正弦波是分析和合成其它信号的基础，因为所有的复杂信号、波形都可以看作为由不同的正弦波叠加而成。（傅里叶变换可以将波形信号分解为一系列的正弦波）



### 音乐波形相关知识


### ADC采集音量大小

```c
void DMA1_Channel1_IRQHandler(void)
{
    DMA_ClearFlag(DMA1_FLAG_GL1, DMA1);
    // sustain get max and min data,  save to buf, when user read, then empty it
    uint32_t adc_value = drv_adc_read(7);
    
    if(adc_value > adc_amplifier_max)   adc_amplifier_max = adc_value;
    if(adc_value < adc_amplifier_min)   adc_amplifier_min = adc_value;
}

// 读取音量值：每当展示完一个音量值的灯效周期后，调用该函数获取下一个音量值，并做灯效展示
uint32_t drv_adc_read_volume(void)
{
    uint32_t volume_value = adc_amplifier_max - adc_amplifier_min;
    logPrintln("waveform max_value=[%d]  min_value=[%d], volume=[%d]", adc_amplifier_max, adc_amplifier_min, volume_value);
    adc_amplifier_max = 0;
    adc_amplifier_min = 4095;
    return volume_value;
}
SHELL_EXPORT_CMD(SHELL_CMD_PERMISSION(0)|SHELL_CMD_TYPE(SHELL_TYPE_CMD_FUNC)|SHELL_CMD_DISABLE_RETURN, drv_adc_read_volume, drv_adc_read_volume, drv_adc_read_volume);

```


### 波形代码分析算法

波峰查找算法



## 参考站点








